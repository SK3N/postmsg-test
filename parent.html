<!DOCTYPE html>
<html lang="ja">

  <head>
    <meta charset="UTF-8">
    <title>親ページ</title>
    <style>
      .parent {
        max-width: 768px;
        margin: 2rem auto;
      }
    </style>
  </head>

  <body>
    <div class="parent">
      <h1>親ページ</h1>

      <iframe id="child-iframe" src="https://potsmsg-test.netlify.app/children.html" width="100%" height="600" style="border:1px solid #ccc;"></iframe>

      <script>
        // クエリ文字列をオブジェクトに変換する関数
        function getQueryParams() {
          const params = {};
          const searchParams = new URLSearchParams(window.location.search);
          for (const [key, value] of searchParams.entries()) {
            params[key] = value;
          }
          return params;
        }

        // iframe に postMessage を送る関数
        function sendToIframe() {
          const iframe = document.querySelector('iframe');
          const trackingData = getQueryParams();
          iframe.contentWindow.postMessage(trackingData, 'https://potsmsg-test.netlify.app');
        }

        // ページ読み込み後、自動で送信
        window.addEventListener('DOMContentLoaded', sendToIframe);
      </script>
    </div>
  </body>

</html>