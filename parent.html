<!DOCTYPE html>
<html lang="ja">

  <head>
    <meta charset="UTF-8">
    <title>親ページ</title>
    <style>
      .parent {
        max-width: 768px;
        margin: 2rem auto;
      }
    </style>
  </head>

  <body>
    <div class="parent">
      <h1>親ページ</h1>

      <iframe id="child-iframe" src="https://potsmsg-test.netlify.app/children.html" width="100%" height="600" style="border:1px solid #ccc;"></iframe>

      <script>
        // クエリ文字列をオブジェクトに変換する関数
        function getQueryParams() {
          const params = {};
          const searchParams = new URLSearchParams(window.location.search);
          for (const [key, value] of searchParams.entries()) {
            params[key] = value;
          }
          // オーガニック検索の判定を追加
          const ref = document.referrer;
          if (ref.includes("google.") || ref.includes("search.yahoo.")) {
            params['organic_source'] = ref;
          }
          return params;
        }

        window.addEventListener('DOMContentLoaded', () => {
          const iframe = document.getElementById("child-iframe");

          iframe.onload = () => {
            const trackingData = getQueryParams();
            console.log("送信内容：", trackingData);
            iframe.contentWindow.postMessage(trackingData, 'https://potsmsg-test.netlify.app');
          };
        });
      </script>
    </div>
  </body>

</html>